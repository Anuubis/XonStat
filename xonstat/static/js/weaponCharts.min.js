function buildColumnInfo(){var e=[0],o={},t=[],a=[];Object.keys(weaponColors).forEach(function(e,o){a.push({column:1+2*o,roleColumns:[1+2*o+1],color:weaponColors[e],display:!0})});for(var r=0;r<a.length;r++){var n=a[r].column;o[n]=r,t[r]={color:a[r].color,backupColor:a[r].color},a[r].display?e.push(n):(e.push({label:data.getColumnLabel(n),type:data.getColumnType(n),sourceColumn:n,calc:function(){return null}}),t[r].color="#444");for(var l=0;l<a[r].roleColumns.length;l++)e.push(a[r].roleColumns[l])}return{columns:e,columnsMap:o,series:t}}function showHideSeries(e,o,t){var a=columnInfo.columns,r=columnInfo.columnsMap,n=columnInfo.series;if("number"==typeof a[t]){var l=a[t];a[t]={label:o.getColumnLabel(l),type:o.getColumnType(l),sourceColumn:l,calc:function(){return null}},n[r[l]].color="#444"}else{var l=a[t].sourceColumn;a[t]=l,n[r[l]].color=n[r[l]].backupColor}var i=e.getView()||{};i.columns=a,e.setView(i),e.draw()}function accuracyValue(e,o){if(void 0==e[o])return null;var t=e[o],a=t.fired<10?Number.NaN:Math.round(t.hit/t.fired*100);return a}function accuracyTooltip(e,o,t,a){if(null==o)return null;var r=a[e],n=e.toUpperCase()+": "+o.toString()+"% ["+r.hit+"/"+r.fired+"]";return void 0!=t[e]?n+" ("+t[e].toString()+"% average)":n}function drawAccuracyChart(e){matchIds=[];var o=new google.visualization.DataTable;o.addColumn("string","X"),Object.keys(weaponColors).forEach(function(e,t){o.addColumn("number",e.toUpperCase()),o.addColumn({type:"string",role:"tooltip"})});var t=flatten(e),a=Object.keys(e.games).length;for(i in e.games){var r=e.games[i],n=[(a--).toString()],l=t[r];matchIds.push(r);for(w in weaponColors){var s=accuracyValue(l,w),u=accuracyTooltip(w,s,e.averages,l);n.push(s),n.push(u)}o.addRow(n)}matchIds.reverse();var c=getPercentageOptions(!1);c.lineWidth=2,c.series=columnInfo.series;var g=new google.visualization.ChartWrapper({chartType:"LineChart",containerId:"chartArea",dataTable:o,options:c,view:{columns:columnInfo.columns}}),d=function(e){var t=g.getChart().getSelection()[0];if(null!=t)if(null==t.row)t.column&&showHideSeries(g,o,t.column);else{var a=matchIds[o.getFormattedValue(t.row,0)-1];window.location.href="/game/"+a.toString()}};google.visualization.events.addListener(g,"select",d),g.draw()}function getPercentageOptions(e){return{backgroundColor:{fill:"transparent"},legend:{textStyle:{color:"#eee"},position:"top"},hAxis:{title:"Games",titleTextStyle:{color:"#eee"},textStyle:{color:"#888"}},vAxis:{title:"Percentage",titleTextStyle:{color:"#eee"},textStyle:{color:"#888"},minValue:0,maxValue:100,baselineColor:"#eee",gridlineColor:"#888",ticks:[20,40,60,80,100]},interpolateNulls:!0}}function fragValue(e,o){return void 0==o[e]?null:o[e].frags}function fragTooltip(e,o,t){if(null==t)return null;if(!o[e])return e.toUpperCase()+": not used";var a=o[e].frags;return e.toUpperCase()+": "+a+(1==a?" kill":" kills")+" ("+Math.round(t).toString()+"%)"}function getFragOptions(e){return{backgroundColor:{fill:"transparent"},legend:{textStyle:{color:"#eee"},position:"top"},hAxis:{title:"Games",titleTextStyle:{color:"#eee"},textStyle:{color:"#888"}},vAxis:{title:"Frags",titleTextStyle:{color:"#eee"},textStyle:{color:"#888"},minValue:0,baselineColor:"#eee",gridlineColor:"#888"},interpolateNulls:!0}}function drawFragChart(e,o){matchIds=[];var t=new google.visualization.DataTable;t.addColumn("string","X"),Object.keys(weaponColors).forEach(function(e,o){t.addColumn("number",e.toUpperCase()),t.addColumn({type:"string",role:"tooltip"})});var a=flatten(e),r=Object.keys(e.games).length;for(i in e.games){var n=e.games[i],l=[(r--).toString()],s=a[n];matchIds.push(n);var u=0;for(var c in s){var g=parseInt(s[c].frags)||0;u+=g}u/=100;for(c in weaponColors){var d=fragValue(c,s),f=d/u,m=fragTooltip(c,s,f);l.push(o?f:d),l.push(m)}t.addRow(l)}matchIds.reverse();var p=o?getPercentageOptions(!0):getFragOptions(!0);p.legend.maxLines=3,p.isStacked=!0,p.series=columnInfo.series;var v=new google.visualization.ChartWrapper({chartType:"ColumnChart",containerId:"chartArea",dataTable:t,options:p,view:{columns:columnInfo.columns}}),h=function(e){var o=v.getChart().getSelection()[0];if(null!=o)if(null==o.row)o.column&&showHideSeries(v,t,o.column);else{var a=matchIds[t.getFormattedValue(o.row,0)-1];window.location.href="/game/"+a.toString()}};google.visualization.events.addListener(v,"select",h),v.draw()}function damageValue(e,o){return void 0==o[e]?null:o[e].max}function damageTooltip(e,o,t){if(null==t)return null;if(!o[e])return e.toUpperCase()+": not used";var a=o[e].max;return e.toUpperCase()+": "+a+" dealt ("+Math.round(t).toString()+"%)"}function getDamageOptions(e){var o={},t=0;for(var a in weaponColors)o[t++]={color:weaponColors[a]};return{backgroundColor:{fill:"transparent"},legend:{textStyle:{color:"#eee"},position:"top"},hAxis:{title:"Games",titleTextStyle:{color:"#eee"},textStyle:{color:"#888"}},vAxis:{title:"Damage dealt",titleTextStyle:{color:"#eee"},textStyle:{color:"#888"},minValue:0,baselineColor:"#eee",gridlineColor:"#888"},series:o,interpolateNulls:!0}}function drawDamageChart(e,o){matchIds=[];var t=new google.visualization.DataTable;t.addColumn("string","X");for(c in weaponColors)t.addColumn("number",c.toUpperCase()),t.addColumn({type:"string",role:"tooltip"});var a=flatten(e),r=Object.keys(e.games).length;for(i in e.games){var n=e.games[i],l=[(r--).toString()],s=a[n];matchIds.push(n);var u=0;for(var c in s){var g=parseInt(s[c].max)||0;u+=g}u/=100;for(c in weaponColors){var d=damageValue(c,s),f=d/u,m=damageTooltip(c,s,f);l.push(o?f:d),l.push(m)}t.addRow(l)}matchIds.reverse();var p=o?getPercentageOptions(!0):getDamageOptions(!0);p.legend.maxLines=3,p.isStacked=!0,p.series=columnInfo.series;var v=new google.visualization.ChartWrapper({chartType:"ColumnChart",containerId:"chartArea",dataTable:t,options:p,view:{columns:columnInfo.columns}}),h=function(e){var o=v.getChart().getSelection()[0];if(null!=o)if(null==o.rows)o.column&&showHideSeries(v,t,o.column);else{var a=matchIds[t.getFormattedValue(o.row,0)-1];window.location.href="/game/"+a.toString()}};google.visualization.events.addListener(v,"select",h),v.draw()}var weaponColors={gt:"#00d8ff",mg:"#ffff40",sg:"#ff8100",gl:"#027812",rl:"#ff0000",lg:"#ffffb0",rg:"#14c513",pg:"#c500ff",hmg:"#cea500",bfg:"#015aff"},columnInfo=buildColumnInfo(),matchIds=[],flatten=function(e){return flattened={},e.games.forEach(function(e,o){flattened[e]={}}),e.weapon_stats.forEach(function(e,o){var t=flattened[e.game_id];void 0!=t&&(t[e.weapon_cd]=e)}),flattened};